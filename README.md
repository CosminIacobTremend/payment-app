#Payment application 
### starting the app 
For running the app it is necessary to have docker and docker-compose installed 

Run the following command in deps folder in order to start infrastructure dependencies:
docker-compose up -d 

### App architecture
The app has a micro service architecture based on Netflix Cloud stack. 
It has a Zuul gateway in front of the 2 microservices: one in charge of the validation of transactions
and one in charge of persisting data the database

Fault tolerance is provided by Zuul gateway and it's integration with Hystrix Api. 
The application relies on spring cloud eureka for service discovery.

The communication between business microservices is asynchronous threw Kafka topics.
The validation microservice send the valid transaction to a Kafka Topic after which it is processed by 
persistence microservice. 
  
The report with user transactions is generated by aggregating data using Kafka Streams API. 
This approach is superior to executing a query to the database each time a report is requested because
data is aggregated in real time in Kafka KTables. 

We have one KTable that is responsible for aggregating user statistic for each topic partition and one 
GlobalKTable that is responsible for aggregating the partition specific KTables. 

When a report is requested data is read directly from the GlobalKTable. 

### Endpoints 
The app has 2 endpoints: 
 1. one for sending a transaction to be processed
  URL: http://localhost:8080/validation/transaction
  Method: Post
  sample request body: 
  {
  	"IBAN": "test_iban_4",
  	"CNP": "test_cnp_2",
  	"name": "test_fn_4 test_ln_4",
  	"sum": 10,
  	"transactionType": "IBAN_TO_WALLET"
  }
 2. one for getting the report with user statistics 
   URL: http://localhost:8080/persistence/transaction_statistics
   METHOD: Get
   Sample Response: 
   [
       {
           "cnp": "test_cnp_2",
           "transactionSumsByType": {
               "IBAN_TO_IBAN": 0,
               "IBAN_TO_WALLET": 30,
               "WALLET_TO_WALLET": 0,
               "WALLET_TO_IBAN": 0
           },
           "transactionCountByIban": {
               "test_iban_4": 3
           }
       }
   ]
   
### Test Data
Data that can be used in testing the application is present in the Flyway migration script V2__test-data.sql
in the payment-persistence microservice.   
  


    